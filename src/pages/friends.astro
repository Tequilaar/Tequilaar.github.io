---
import Layout from '~/layouts/Layout.astro'
import BlockHeader from '~/components/BlockHeader.astro'
import FriendCard from '~/components/FriendCard.astro'
import friends from '~/data/friends.json'
import { fetchLatest } from '~/utils'

const sorted = (friends as any[]).slice().sort((a, b) => {
  const pa = a.priority ?? 0
  const pb = b.priority ?? 0

  if (pa !== pb) return pb - pa

  if ((b.reciprocal ? 1 : 0) !== (a.reciprocal ? 1 : 0)) {
    return (b.reciprocal ? 1 : 0) - (a.reciprocal ? 1 : 0)
  }
  return String(a.name).localeCompare(String(b.name), 'zh-Hans-CN')
})

const enriched = await Promise.all(
  sorted.map(async (f) => ({
    ...f,
    latest: f.rss ? await fetchLatest(f.rss, 2) : []
  }))
)
---

<Layout title="友链" description="互相链接，彼此增光 ✨">
  <section>
    <BlockHeader>友链</BlockHeader>
    <p class="mt-2 text-[var(--ec-foreground-muted)]">
      想交换友链？给我发邮件：<a class="underline" href="mailto:aritxonly@outlook.com">aritxonly@outlook.com</a>。
      支持展示 RSS。
    </p>

    <div class="grid gap-4 sm:grid-cols-2 mt-4 auto-rows-fr items-stretch">
      {enriched.map((f) => <FriendCard friend={f} />)}
    </div>
  </section>

  <section class="mt-8">
    <BlockHeader>友链收录要求</BlockHeader>
    <ul class="list-disc pl-5 text-[var(--ec-foreground-muted)]">
      <li>原创内容为主，主题不限；</li>
      <li>站点稳定可访问；</li>
      <li>请在你的网站中添加指向本博客的链接（互链更佳）。</li>
    </ul>
  </section>
</Layout>